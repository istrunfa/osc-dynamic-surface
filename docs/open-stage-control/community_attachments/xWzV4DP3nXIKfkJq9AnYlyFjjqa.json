{
  "version": "1.25.0",
  "type": "session",
  "createdWith": "Open Stage Control",
  "content": {
    "type": "root",
    "id": "root",
    "visible": true,
    "interaction": true,
    "width": "auto",
    "height": "auto",
    "colorText": "auto",
    "colorWidget": "auto",
    "alphaFillOn": "auto",
    "padding": "auto",
    "html": "",
    "css": ".matrix-container{--widget-padding:0; padding:0;}\n.button-container{font-size:140%;}\n.switch-container{--widget-padding:0; margin:0; padding:0; font-size:140%;}\n.menu-container{--widget-padding:0; margin:0;padding:0;}\nlabel, html,div, body{font-family:\"Roboto Condensed\"; text-transform:uppercase;}\n.root >.navigation{\n--nav-height:60px;\n}",
    "colorBg": "auto",
    "layout": "default",
    "justify": "start",
    "gridTemplate": "",
    "contain": true,
    "scroll": true,
    "innerPadding": true,
    "variables": {
      "localhost": "192.168.1.100"
    },
    "traversing": false,
    "value": "",
    "default": "",
    "linkId": "",
    "address": "auto",
    "preArgs": "",
    "typeTags": "",
    "decimals": 2,
    "target": "",
    "ignoreDefaults": true,
    "bypass": true,
    "widgets": [],
    "tabs": [
      {
        "type": "tab",
        "id": "tab_sequencer",
        "visible": true,
        "interaction": true,
        "comments": "",
        "colorText": "auto",
        "colorWidget": "auto",
        "colorFill": "auto",
        "padding": 0,
        "html": "",
        "css": "",
        "colorBg": "auto",
        "layout": "default",
        "justify": "start",
        "gridTemplate": "",
        "contain": true,
        "scroll": true,
        "innerPadding": true,
        "label": "Seq",
        "variables": "@{parent.variables}",
        "traversing": false,
        "value": "",
        "default": "",
        "linkId": "",
        "address": "auto",
        "preArgs": "",
        "typeTags": "",
        "decimals": 2,
        "target": "",
        "ignoreDefaults": false,
        "bypass": false,
        "widgets": [
          {
            "type": "script",
            "id": "setup_sequencer",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "comments": "",
            "onValue": "",
            "lock": false,
            "onCreate": "globals.setup_sequencer = function(){\n  const numBanks = Object.keys(getProp('seq_bank_selector', 'values')).length,\n  numSeq = Object.keys(getProp('seq_pattern_selector', 'values')).length,\n  totalSeq = numSeq * numBanks, patIdx = globals.get_current_pattern_index(), inst = get(\"seq_inst_selector\")\n\n  //get patterns from storage\n  globals.sequences = storage.getItem(\"sequences\"), globals.mixerStates = storage.getItem(\"mixerStates\")\n  globals.send_mixer_state()\n  stateSet(globals.sequences[inst][patIdx])\n  console.log(\"loading sequences from storage\", globals.sequences)\n  //globals.send_pattern()\n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "id": "seq_connect",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onValue": "var trackNames = value\nconsole.log(\"connection\", trackNames, globals, trackNames.length)\n  if (trackNames.length > 0){\n    console.log(\"sequencer connected\",trackNames)\n    globals.seq_connected = true\n    globals.setup_sequencer()\n    for (var i in globals.seq_instruments) {\n      if (trackNames !== null && trackNames.includes(globals.seq_instruments[i].trackName)) {\n        globals.seq_instruments[i].connected = true\n      }\n      else {\n        globals.seq_instruments[i].connected = false\n      }\n    }\n    \n  } else{\n    console.log(\"sequencer disconnected\")\n    set('seq_on', 1, {external: true})\n    globals.seq_connected = false\n    for (var i in globals.seq_instruments) {\n        globals.seq_instruments[i].connected = false\n    }\n  }\n  updateProp('seq_inst_selector', 'css')\n  updateProp('seq_on', 'interaction')\n",
            "lock": false,
            "onCreate": "",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "id": "get_inst",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onValue": "",
            "lock": false,
            "onCreate": "globals.get_inst = function () {\n  const key = get('seq_inst_selector')\n  return globals.seq_instruments[key]\n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "id": "get_current_pattern_index",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onValue": "",
            "lock": false,
            "onCreate": "globals.get_current_pattern_index = function () {\n  const pat = get('seq_pattern_selector'),\n    bank = get('seq_bank_selector'),\n    numPerBank = Object.keys(getProp('seq_pattern_selector', 'values')).length\n  return bank * numPerBank + pat\n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "variable",
            "id": "save_sequence",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onValue": "",
            "lock": false,
            "onCreate": "globals.save_sequence = function(){\n  const patIdx = globals.get_current_pattern_index(), instKey = get('seq_inst_selector')\n  var sequences = get('sequences')\n  sequences[instKey][patIdx] = stateGet('sequencer')\n  set('sequences', sequences)\n}"
          },
          {
            "type": "script",
            "id": "mute_inst",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onValue": "",
            "lock": false,
            "onCreate": "globals.mute_inst = function(inst = 0){\n  console.log(\"muting instrument\", inst, globals.seq_solo)\n  \n  //check for solo\n  \n  if(globals.seq_solo !== undefined && globals.seq_solo == inst ){\n    globals.seq_solo = -1\n    globals.seq_muted = []\n  } else if(globals.seq_muted && globals.seq_muted.includes(inst)){\n    globals.seq_muted.splice(globals.seq_muted.indexOf(inst),1)\n  } else if(globals.seq_muted){\n    globals.seq_muted.push(inst)\n  } else{\n    globals.seq_muted = [inst]\n  }\n  console.log('seq_mutes', globals.seq_muted)\n  updateProp('seq_drum_mutes' , 'props')\n    globals.send_mutes()  \n\n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "id": "solo_inst",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onValue": "",
            "lock": false,
            "onCreate": "globals.solo_inst = function(inst = -1){\n  var numInst = Object.keys(globals.seq_instruments).length\n  if(globals.seq_solo !== undefined && globals.seq_solo == inst){\n    console.log(\"unsolo\", globals.seq_solo, inst)\n    globals.seq_muted = []\n    globals.seq_solo = -1\n  } else{\n    console.log(\"solo\", globals.seq_solo, inst)\n\n    globals.seq_solo = inst\n    globals.seq_muted = Array.from(Array(numInst).keys())\n    globals.seq_muted.splice(globals.seq_muted.indexOf(inst),1)\n  }\n  setTimeout(function(){\n    updateProp('seq_drum_mutes', 'props')\n    globals.send_mutes()  \n  },1)\n  \n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "id": "send_seq",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onValue": "",
            "lock": false,
            "onCreate": "globals.send_seq = function () {\n  const num_steps = get('seq_steps')\n  const inst = globals.get_inst()\n  var start_times = Array(num_steps)\n  var velocities = Array(num_steps)\n  const res = get('seq_resolution')\n  \n  Array.from(Array(num_steps)).map((_, i) => {\n    start_times[i] = i * res\n\n    velocities[i] = get('command_velocity') ? get('seq_faders/' + i) : get('seq_buttons/' + i)\n  });\n\n  send('/live/seq/set_notes', inst.trackName, inst.pitch, String(start_times), String(velocities))\n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "id": "set_length",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "comments": "",
            "onValue": "",
            "lock": false,
            "onCreate": "globals.set_length = function () {\n  const trackName = globals.get_inst().trackName\n  globals.send_seq()\n  send('/live/seq/set_length', trackName, get('seq_steps') * get('seq_resolution'))\n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "id": "set_pattern",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "comments": "",
            "onValue": "",
            "lock": false,
            "onCreate": "globals.set_pattern = function () {\n  const patIdx = globals.get_current_pattern_index()\n  globals.patterns[locals.prevIdx] = stateGet('seq_container')\n  locals.prevIdx = patIdx\n  if (globals.patterns[patIdx] === undefined) {\n    console.log(\"seq1 setting empty state\", globals.emptyPattern)\n    stateSet(globals.emptyPattern)\n  } else\n    stateSet(globals.patterns[patIdx])\n}",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "lock": false,
            "id": "send_mixer_state",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "globals.send_mixer_state = function(){\n  for(var inst in globals.seq_instruments){\n    for(var control in globals.seq_instruments[inst].controls){\n      const id = \"seq_\" + inst + \"_\" + control\n      set(id, get(id), { send: true });      \n    }\n}\n}",
            "onValue": "globals.send_mixer_state()",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "lock": false,
            "id": "send_pattern",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "/test/send_pattern",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "globals.send_pattern = function(){\n  \n  set('seq_inst_selector',get('seq_inst_selector'))\n  \n\n\n  var sequences = get('sequences'), pIdx = globals.get_current_pattern_index()\n  \n  //iterate through each instrument\n  Object.keys(globals.seq_instruments).forEach(instName => {\n    //get sequences associated with instrument\n    var seq = sequences[instName][pIdx],\n    inst = globals.seq_instruments[instName]\n    \n    if(seq !== undefined){\n      var start_times = Array(seq.seq_steps), velocities = Array(seq.seq_steps)\n      const res = seq.seq_resolution\n      \n      Array.from(Array(seq.seq_steps)).map((_, i) => {\n        start_times[i] = i * res\n        velocities[i] = seq[\"seq_faders/\" + i]\n      });\n      \n      //send('/live/seq/set_length', inst.trackName, seq.seq_steps * seq.seq_resolution)\n      send('/live/seq/set_notes', inst.trackName, inst.pitch, String(start_times), String(velocities))\n    }else{\n      send('/live/seq/set_notes', inst.trackName, inst.pitch, \"\", \"\")\n    }\n  });\n\n}",
            "onValue": "globals.send_pattern()",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "lock": false,
            "id": "seq_position",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": "//console.log(\"sequencer position\",value)",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "variable",
            "lock": false,
            "id": "seq_instruments",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "globals.seq_instruments = {\n  \"BD\": { \"trackName\": \"BD\", \"pitch\": 36, \"controls\": {   \"Level\": 0,   \"Tone\": 1,   \"Decay\": 2,   \"Sweep\": 3 } },\n  \"SD\": { \"trackName\": \"SD\", \"pitch\": 38, \"controls\": {   \"Level\": 4,   \"Tone\": 5,   \"Decay\": 6,   \"Snap\": 7 } },\n  \"LC\": { \"trackName\": \"LConga\", \"pitch\": 61, \"controls\": {   \"Level\": 8,   \"Tuning\": 9,   \"Decay\": 10 } },\n  \"MC\": { \"trackName\": \"MConga\", \"pitch\": 63, \"controls\": {   \"Level\": 11,   \"Tuning\": 12,   \"Decay\": 13 } },\n  \"HC\": { \"trackName\": \"HConga\", \"pitch\": 60, \"controls\": {   \"Level\": 14,   \"Tuning\": 15,   \"Decay\": 16 } },\n  \"LT\": { \"trackName\": \"LTom\", \"pitch\": 41, \"controls\": {   \"Level\": 17,   \"Tuning\": 18,   \"Decay\": 19,   \"Snap\": 20 } },\n  \"MT\": { \"trackName\": \"MTom\", \"pitch\": 47, \"controls\": {   \"Level\": 21,   \"Tuning\": 22,   \"Decay\": 23,   \"Snap\": 24 } },\n  \"HT\": { \"trackName\": \"HTom\", \"pitch\": 50, \"controls\": {   \"Level\": 25,   \"Tuning\": 26,   \"Decay\": 27,   \"Snap\": 28 } },\n  \"CL\": { \"trackName\": \"Claves\", \"pitch\": 75, \"controls\": {   \"Level\": 29,   \"Tuning\": 30,   \"Decay\": 31 } },\n  \"RS\": { \"trackName\": \"Rim\", \"pitch\": 37, \"controls\": {   \"Level\": 32,   \"Tuning\": 33,   \"Decay\": 34 } },\n  \"MA\": { \"trackName\": \"Maracas\", \"pitch\": 70, \"controls\": {   \"Level\": 35,   \"Tone\": 36 } },\n  \"CP\": { \"trackName\": \"Clap\", \"pitch\": 39, \"controls\": {   \"Level\": 37,   \"Tone\": 38,   \"Reverb\": 39 } },\n  \"CB\": { \"trackName\": \"Bell\", \"pitch\": 56, \"controls\": {   \"Level\": 40,   \"Tuning\": 41,   \"Decay\": 42 } },\n  \"LG\": { \"trackName\": \"Laser\", \"pitch\": 58, \"controls\": {   \"Level\": 43,   \"Depth\": 44,   \"Decay\": 45,   \"Sweep\": 46 } },\n  \"CY\": { \"trackName\": \"Cym\", \"pitch\": 51, \"controls\": {   \"Level\": 47,   \"Tone\": 48,   \"Decay\": 49 } },\n  \"OH\": { \"trackName\": \"OH\", \"pitch\": 46, \"controls\": {   \"Level\": 50,   \"Tone\": 51,   \"Decay\": 52 } },\n  \"CH\": { \"trackName\": \"CH\", \"pitch\": 42, \"controls\": {   \"Level\": 53,   \"Tone\": 54,   \"Decay\": 55,   \"Freq\": 56 } }\n}",
            "onValue": ""
          },
          {
            "type": "panel",
            "lock": false,
            "id": "seq_master_controls",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": "",
            "top": 0,
            "left": 0,
            "visible": true,
            "interaction": true,
            "width": "100%",
            "height": "5%",
            "expand": "false",
            "colorText": "auto",
            "colorWidget": "auto",
            "colorStroke": "auto",
            "colorFill": "auto",
            "alphaStroke": "auto",
            "alphaFillOff": "auto",
            "alphaFillOn": "auto",
            "lineWidth": 0,
            "padding": 0,
            "html": "",
            "css": "",
            "colorBg": "auto",
            "layout": "horizontal",
            "justify": "start",
            "gridTemplate": 3,
            "contain": true,
            "scroll": true,
            "innerPadding": true,
            "variables": "@{parent.variables}",
            "traversing": false,
            "widgets": [
              {
                "type": "button",
                "top": 0,
                "left": "25%",
                "lock": false,
                "id": "seq_on",
                "visible": true,
                "interaction": "#{globals.seq_connected}",
                "comments": "",
                "width": "8%",
                "height": "auto",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "#{ @{this} == @{this.on} ? 'red' : 'green' }",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": 0.4,
                "alphaFillOn": 0.4,
                "lineWidth": "auto",
                "padding": "auto",
                "html": "",
                "css": "",
                "colorTextOn": "auto",
                "label": "#{ @{this} == @{this.on} ? '^stop' : '^play' }",
                "vertical": false,
                "wrap": false,
                "on": 1,
                "off": 0,
                "mode": "toggle",
                "doubleTap": false,
                "value": "OSC{/seq_on, 0}",
                "default": "",
                "linkId": "",
                "address": "/live/seq/toggle_play",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "",
                "borderRadius": "auto",
                "decoupled": false
              },
              {
                "type": "button",
                "top": 0,
                "left": 0,
                "lock": false,
                "id": "seq_clear_all",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "8%",
                "height": "auto",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": "auto",
                "padding": "auto",
                "html": "",
                "css": "",
                "colorTextOn": "auto",
                "label": "Clear All",
                "vertical": false,
                "wrap": false,
                "on": 1,
                "off": 0,
                "mode": "momentary",
                "doubleTap": false,
                "value": "",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "var sequences = get('sequences')\nconsole.log(sequences)\nconst pIdx = globals.get_current_pattern_index()\n\nfor(var instName in globals.seq_instruments){\n  if(sequences[instName][pIdx]){\n    for(var n in sequences[instName][pIdx].seq_faders ){\n      sequences[instName][pIdx]['seq_faders/' + n] = 0\n      sequences[instName][pIdx]['seq_buttons/' + n] = 0\n    }\n  sequences[instName][pIdx].seq_faders = []\n  sequences[instName][pIdx].seq_buttons = []\n}\n}\n// console.log('sequences after', sequences)\nset('sequences',sequences)\nset('seq_inst_selector', get('seq_inst_selector'))\nglobals.send_pattern()",
                "borderRadius": "auto",
                "decoupled": false
              },
              {
                "type": "switch",
                "top": 20,
                "left": 70,
                "lock": false,
                "id": "seq_bank_selector",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "25%",
                "height": "auto",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "#cf2323",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": "auto",
                "padding": "auto",
                "html": "",
                "css": "",
                "colorTextOn": "auto",
                "layout": "horizontal",
                "gridTemplate": 4,
                "wrap": false,
                "values": {
                  "1": 0,
                  "2": 1,
                  "3": 2,
                  "4": 3
                },
                "mode": "tap",
                "value": "",
                "default": 0,
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "",
                "borderRadius": "auto"
              },
              {
                "type": "switch",
                "top": 10,
                "left": 30,
                "lock": false,
                "id": "seq_pattern_selector",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "64%",
                "height": "auto",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "#ff8600",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": "auto",
                "padding": "auto",
                "html": "",
                "css": "",
                "colorTextOn": "auto",
                "layout": "horizontal",
                "gridTemplate": "",
                "wrap": false,
                "values": {
                  "1": 0,
                  "2": 1,
                  "3": 2,
                  "4": 3,
                  "5": 4,
                  "6": 5,
                  "7": 6,
                  "8": 7
                },
                "mode": "tap",
                "value": "",
                "default": 0,
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "locals.prevIdx = getProp('this','default')",
                "onValue": "  //save mixer state\n  var mixerState = get('mixer_settings'), pIdx = globals.get_current_pattern_index()\n\n  if(mixerState[pIdx] !== undefined)\n    stateSet(mixerState[pIdx])\nglobals.send_pattern()\n//globals.send_mixer_state()",
                "borderRadius": "auto"
              },
              {
                "type": "button",
                "top": 10,
                "left": 80,
                "lock": false,
                "id": "seq_save",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "8%",
                "height": "auto",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": "auto",
                "padding": "auto",
                "html": "",
                "css": "",
                "colorTextOn": "auto",
                "label": "Save",
                "vertical": false,
                "wrap": false,
                "on": 1,
                "off": 0,
                "mode": "push",
                "doubleTap": false,
                "value": "",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "storage.setItem('sequences', get('sequences'))",
                "borderRadius": "auto",
                "decoupled": false
              },
              {
                "type": "button",
                "top": 20,
                "left": 50,
                "lock": false,
                "id": "seq_random",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "auto",
                "height": "auto",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": "auto",
                "padding": "auto",
                "html": "",
                "css": "",
                "colorTextOn": "auto",
                "label": "Rand",
                "vertical": false,
                "wrap": false,
                "on": 1,
                "off": 0,
                "mode": "toggle",
                "doubleTap": false,
                "value": "",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "    set('seq_on', 1, {external: true})\n",
                "borderRadius": "auto",
                "decoupled": false
              }
            ],
            "tabs": [],
            "borderRadius": "auto",
            "tabsPosition": "top"
          },
          {
            "type": "variable",
            "lock": false,
            "id": "seq_colors",
            "comments": "",
            "value": [
              "#FF0000",
              "#FF3300",
              "#FF6600",
              "#FF9900",
              "#FFCC00",
              "#FFFF00",
              "#CCFF00",
              "#99FF00",
              "#66FF00",
              "#33FF00",
              "#00FF00",
              "#00FF33",
              "#00FF66",
              "#00FF99",
              "#00FFCC",
              "#00FFFF",
              "#00CCFF",
              "#0099FF",
              "#0066FF",
              "#0033FF",
              "#0000FF"
            ],
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": ""
          },
          {
            "type": "panel",
            "top": "5%",
            "left": 0,
            "lock": false,
            "id": "seq_container",
            "visible": true,
            "interaction": true,
            "comments": "",
            "width": "100%",
            "height": "95%",
            "expand": "false",
            "colorText": "auto",
            "colorWidget": "auto",
            "colorStroke": "auto",
            "colorFill": "auto",
            "alphaStroke": "auto",
            "alphaFillOff": "auto",
            "alphaFillOn": "auto",
            "lineWidth": "auto",
            "padding": "auto",
            "html": "",
            "css": "",
            "colorBg": "auto",
            "layout": "default",
            "justify": "start",
            "gridTemplate": "",
            "contain": true,
            "scroll": true,
            "innerPadding": true,
            "variables": "@{parent.variables}",
            "traversing": false,
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": "",
            "widgets": [
              {
                "type": "variable",
                "lock": false,
                "id": "sequences",
                "comments": "",
                "value": "",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "var seqs = {}\nObject.keys(globals.seq_instruments).forEach(name => {\n  seqs[name] = {};\n});\nset('sequences', seqs)\n",
                "onValue": ""
              },
              {
                "type": "variable",
                "lock": false,
                "id": "mixer_settings",
                "comments": "",
                "value": "",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "set('this',{})",
                "onValue": ""
              },
              {
                "type": "switch",
                "top": "65%",
                "left": 0,
                "lock": false,
                "id": "seq_inst_selector",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "100%",
                "height": "7.5%",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": 0,
                "alphaFillOff": 0.25,
                "alphaFillOn": 0.75,
                "lineWidth": 0,
                "padding": "auto",
                "html": "",
                "css": "JS{{\n   var colors = @{seq_colors},\n    instruments = globals.seq_instruments,\n    css = \"\"\n    \n    for (const [index, [key, value]] of Object.entries(Object.entries(instruments))) {\n      var child = parseInt(index) + 1\n      css += \"value:nth-child(\" + child + \"){--color-fill:\"\n      if (instruments[key].connected == true){\n        \n        css += colors[index]\n        \n      } else{\n\n        css += \"grey\"\n      }\n      \n      css+= \";}\"\n      \n    }\n    return css\n}}",
                "layout": "horizontal",
                "gridTemplate": "",
                "value": "BD",
                "default": "BD",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": true,
                "onCreate": "locals.sequence = {}\n//current pattern\nglobals.selected = \"BD\"\n",
                "onValue": "  const trackName = globals.seq_instruments[value].trackName,patIdx = globals.get_current_pattern_index()\n  var sequences = get('sequences')\n\n  send('/live/seq/select',trackName)\n  globals.selected = trackName\n\n  if(sequences[value][patIdx] === undefined){\n    console.log(\"setting default state\")\n    stateSet(globals.emptySequence)\n  } else{\n    stateSet(sequences[value][patIdx])\n  }\n  //loads the state of the newly selected instrument\n  globals.set_length()\n",
                "colorTextOn": "auto",
                "wrap": false,
                "values": "#{Object.keys(globals.seq_instruments)}",
                "mode": "tap",
                "borderRadius": "auto"
              },
              {
                "type": "matrix",
                "top": "0%",
                "left": 0,
                "lock": false,
                "id": "seq_mixer",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "100%",
                "height": "65%",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": "auto",
                "padding": "auto",
                "html": "",
                "css": "inner{\n  grid-auto-flow: column;\n}",
                "layout": "grid",
                "gridTemplate": "repeat(4, auto) / repeat(#{Object.keys(globals.seq_instruments).length}, auto)",
                "value": "",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "var mixerState = get('mixer_settings'), pIdx = globals.get_current_pattern_index()\n\nmixerState[pIdx] = stateGet('seq_mixer')\nset('mixer_settings', mixerState)",
                "colorBg": "auto",
                "justify": "start",
                "contain": true,
                "scroll": true,
                "innerPadding": true,
                "variables": "@{parent.variables}",
                "traversing": false,
                "widgetType": "fader",
                "quantity": "#{Object.keys(globals.seq_instruments).length * 4}",
                "props": "JS{\n  const p = {},   colors = @{seq_colors}, column = parseInt($ / 4), rowInColumn = $ - (column * 4),\n  instruments = globals.seq_instruments,\n  keys = Object.keys(instruments),\n  instrumentName = keys[column],\n  controls = instruments[instrumentName].controls,\n  controlNames = Object.keys(controls)\n  \n \n  if(controlNames.length <= rowInColumn){\n    p.interaction = false\n    p.visible = false\n    p.css = ':host{visibility:hidden;}'\n  } else{\n    const controlName = Object.keys(controls)[rowInColumn],\n    controlNum = parseInt(controls[controlName])+1\n    p.html = controlName\n    p.id = \"seq_\" + instrumentName + \"_\" + controlName\n    p.onValue = 'send(\"/live/control\",\"DrumMachine\",'+controlNum+\",1, value)\"\n    p.bypass = true\n    p.default = 1- rowInColumn * .25\n    p.value = 1 - rowInColumn * .25\np.css = @{vertical_text_css}\n  }\n  p.colorWidget = colors[column]\n  p.design=\"compact\"\n  \n  \n  //Fader Bank Props\n  p.visible = true\n  p.interaction = true\n  \n  return p\n}",
                "widgets": [],
                "tabs": [],
                "borderRadius": "auto",
                "tabsPosition": "top"
              },
              {
                "type": "matrix",
                "top": "72.5%",
                "left": 0,
                "lock": false,
                "id": "seq_drum_mutes",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "100%",
                "height": "7.5%",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": 0,
                "padding": "auto",
                "html": "",
                "css": "",
                "layout": "horizontal",
                "gridTemplate": "",
                "value": "#{Object.keys(globals.seq_instruments)}",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "",
                "colorBg": "auto",
                "justify": "start",
                "contain": true,
                "scroll": true,
                "innerPadding": true,
                "variables": "@{parent.variables}",
                "traversing": true,
                "widgets": [],
                "tabs": [],
                "widgetType": "button",
                "quantity": "#{Object.keys(globals.seq_instruments).length}",
                "props": "JS{\n  \n  const colors = @{seq_colors}\n  \n  const p = {}\n  const values = globals.seq_instruments\n  const labels = Object.keys(values).map(key => values[key].trackName)\n  p.value = 1\n  p.colorWidget = colors[$]\n  p.label = labels[$]\n  p.lineWidth = 1\n  p.mode = 'push'\n  p.alphaFillOff = 0.05\n  p.alphaFillOn = .5\n  p.preArgs = labels[$]\n  p.ingoreDefaults = true\n  p.bypass = true\n  p.id = \"seq_drum_mutes/\" + $\n  p.onValue = 'globals.long_press_button(value,'+$+',() => { globals.solo_inst('+$+')}, () => { globals.mute_inst('+$+')})'\n  p.decoupled = true\n  \n  if(globals.seq_solo == $){\n    p.alphaFillOff = 1\n    p.colorWidget = '#40a0ff'\n\n  }else if(globals.seq_muted && globals.seq_muted.includes($)){\n    p.alphaFillOff = 0.1\n  }\n  else{\n    p.alphaFillOff = .5\n\n  } \n  return p\n  \n}",
                "borderRadius": "auto",
                "tabsPosition": "top"
              },
              {
                "type": "panel",
                "lock": false,
                "id": "sequencer",
                "comments": "",
                "value": "VAR(numSteps,16)",
                "default": "",
                "linkId": "",
                "address": "auto",
                "preArgs": "",
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "globals.emptySequence = stateGet('sequencer')",
                "onValue": "",
                "top": "80%",
                "left": 0,
                "visible": true,
                "interaction": true,
                "width": "100%",
                "height": "20%",
                "expand": "false",
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": 0,
                "padding": "auto",
                "html": "",
                "css": ":host div.tablink.on{\n  background:white;\n}\n:host div.tablink{\n  background:none;\n  text-indent:-999em;\n}\n",
                "colorBg": "auto",
                "layout": "default",
                "justify": "start",
                "gridTemplate": "",
                "contain": true,
                "scroll": true,
                "innerPadding": true,
                "variables": "@{parent.variables}",
                "traversing": false,
                "widgets": [
                  {
                    "type": "panel",
                    "top": 0,
                    "left": "60%",
                    "lock": false,
                    "id": "seq_commands",
                    "visible": true,
                    "interaction": true,
                    "comments": "",
                    "width": "40%",
                    "height": "30%",
                    "expand": "false",
                    "colorText": "auto",
                    "colorWidget": "auto",
                    "colorStroke": "auto",
                    "colorFill": "auto",
                    "alphaStroke": "auto",
                    "alphaFillOff": "auto",
                    "alphaFillOn": "auto",
                    "lineWidth": 0,
                    "padding": 0,
                    "html": "",
                    "css": "",
                    "colorBg": "auto",
                    "layout": "grid",
                    "justify": "start",
                    "gridTemplate": 4,
                    "contain": true,
                    "scroll": true,
                    "innerPadding": true,
                    "variables": "@{parent.variables}",
                    "traversing": false,
                    "value": "",
                    "default": "",
                    "linkId": "",
                    "address": "auto",
                    "preArgs": "",
                    "typeTags": "",
                    "decimals": 2,
                    "target": "",
                    "ignoreDefaults": false,
                    "bypass": false,
                    "onCreate": "",
                    "onValue": "",
                    "widgets": [
                      {
                        "type": "button",
                        "top": 0,
                        "left": 110,
                        "lock": false,
                        "id": "command_clear",
                        "visible": true,
                        "interaction": true,
                        "comments": "",
                        "width": "auto",
                        "height": "auto",
                        "expand": "false",
                        "colorText": "auto",
                        "colorWidget": "auto",
                        "colorStroke": "auto",
                        "colorFill": "auto",
                        "alphaStroke": "auto",
                        "alphaFillOff": "auto",
                        "alphaFillOn": "auto",
                        "lineWidth": 0,
                        "padding": 0,
                        "html": "",
                        "css": "",
                        "colorTextOn": "auto",
                        "label": "Clear",
                        "vertical": false,
                        "wrap": false,
                        "on": 1,
                        "off": 0,
                        "mode": "tap",
                        "doubleTap": false,
                        "value": "",
                        "default": "",
                        "linkId": "",
                        "address": "auto",
                        "preArgs": "",
                        "typeTags": "",
                        "decimals": 2,
                        "target": "",
                        "ignoreDefaults": false,
                        "bypass": false,
                        "onCreate": "",
                        "onValue": "for(var i=0; i<get('seq_steps'); i++){\n set(\"seq_buttons/\"+i,0)\n set(\"seq_faders/\"+i,0)\n}\nglobals.send_seq()\n  globals.save_sequence()\n",
                        "borderRadius": "auto",
                        "decoupled": false
                      },
                      {
                        "type": "button",
                        "top": 90,
                        "left": 150,
                        "lock": false,
                        "id": "command_randomize",
                        "visible": true,
                        "interaction": true,
                        "comments": "",
                        "width": "auto",
                        "height": "auto",
                        "expand": "false",
                        "colorText": "auto",
                        "colorWidget": "auto",
                        "colorStroke": "auto",
                        "colorFill": "auto",
                        "alphaStroke": "auto",
                        "alphaFillOff": "auto",
                        "alphaFillOn": "auto",
                        "lineWidth": 0,
                        "padding": 0,
                        "html": "",
                        "css": "",
                        "colorTextOn": "auto",
                        "label": "Random",
                        "vertical": false,
                        "wrap": false,
                        "on": 1,
                        "off": 0,
                        "mode": "tap",
                        "doubleTap": false,
                        "value": "",
                        "default": "",
                        "linkId": "",
                        "address": "auto",
                        "preArgs": "",
                        "typeTags": "",
                        "decimals": 2,
                        "target": "",
                        "ignoreDefaults": false,
                        "bypass": false,
                        "onCreate": "",
                        "onValue": "for(var i=0; i<get('seq_steps'); i++)\n{\n  var rand = Math.random();\n   rand = rand > .5 ? rand : 0\n\n  set(\"seq_faders/\"+i,rand, {sync:false});\n  set(\"seq_buttons/\"+i,Math.round(rand),{sync:false})\n}\nglobals.send_seq()\n  globals.save_sequence()\n\n",
                        "borderRadius": "auto",
                        "decoupled": false
                      },
                      {
                        "type": "button",
                        "top": 20,
                        "left": 40,
                        "lock": false,
                        "id": "command_velocity",
                        "visible": true,
                        "interaction": true,
                        "comments": "",
                        "width": "auto",
                        "height": "auto",
                        "expand": "false",
                        "colorText": "auto",
                        "colorWidget": "auto",
                        "colorStroke": "auto",
                        "colorFill": "auto",
                        "alphaStroke": "auto",
                        "alphaFillOff": "auto",
                        "alphaFillOn": "auto",
                        "lineWidth": 0,
                        "padding": 0,
                        "html": "",
                        "css": "",
                        "colorTextOn": "auto",
                        "label": "Velocity",
                        "vertical": false,
                        "wrap": false,
                        "on": 1,
                        "off": 0,
                        "mode": "toggle",
                        "doubleTap": false,
                        "value": "",
                        "default": "",
                        "linkId": "",
                        "address": "auto",
                        "preArgs": "",
                        "typeTags": "",
                        "decimals": 2,
                        "target": "",
                        "ignoreDefaults": false,
                        "bypass": false,
                        "onCreate": "",
                        "onValue": "//globals.send_seq()\n  globals.save_sequence()\n",
                        "borderRadius": "auto",
                        "decoupled": false
                      },
                      {
                        "type": "button",
                        "top": 20,
                        "left": 50,
                        "lock": false,
                        "id": "seq_note_echo_all",
                        "visible": true,
                        "interaction": true,
                        "comments": "",
                        "width": "auto",
                        "height": "auto",
                        "expand": "false",
                        "colorText": "auto",
                        "colorWidget": "auto",
                        "colorStroke": "auto",
                        "colorFill": "auto",
                        "alphaStroke": "auto",
                        "alphaFillOff": "auto",
                        "alphaFillOn": "auto",
                        "lineWidth": 0,
                        "borderRadius": "auto",
                        "padding": 0,
                        "html": "",
                        "css": "",
                        "colorTextOn": "auto",
                        "label": "Echo",
                        "vertical": false,
                        "wrap": false,
                        "on": 1,
                        "off": 0,
                        "mode": "toggle",
                        "doubleTap": false,
                        "decoupled": false,
                        "value": "",
                        "default": "",
                        "linkId": "",
                        "address": "auto",
                        "preArgs": "",
                        "typeTags": "",
                        "decimals": 2,
                        "target": "",
                        "ignoreDefaults": false,
                        "bypass": true,
                        "onCreate": "",
                        "onValue": ""
                      }
                    ],
                    "tabs": [],
                    "borderRadius": "auto",
                    "tabsPosition": "top"
                  },
                  {
                    "type": "switch",
                    "top": 0,
                    "left": "40%",
                    "lock": false,
                    "id": "seq_resolution",
                    "visible": true,
                    "interaction": true,
                    "comments": "",
                    "width": "20%",
                    "height": "30%",
                    "expand": "false",
                    "colorText": "auto",
                    "colorWidget": "#ffffff",
                    "colorStroke": "auto",
                    "colorFill": "auto",
                    "alphaStroke": "auto",
                    "alphaFillOff": "auto",
                    "alphaFillOn": "auto",
                    "lineWidth": 0,
                    "padding": "auto",
                    "html": "",
                    "css": "",
                    "colorTextOn": "auto",
                    "layout": "horizontal",
                    "gridTemplate": 4,
                    "wrap": false,
                    "values": {
                      "1/4": 1,
                      "1/8": 0.5,
                      "1/12": 0.33333,
                      "1/16": 0.25,
                      "1/32": 0.125
                    },
                    "mode": "tap",
                    "value": 0.25,
                    "default": 0.25,
                    "linkId": "",
                    "address": "auto",
                    "preArgs": "",
                    "typeTags": "",
                    "decimals": 2,
                    "target": "",
                    "ignoreDefaults": false,
                    "bypass": true,
                    "onCreate": "",
                    "onValue": "console.log(\"triggering resolution change\")\n//globals.set_length()\nglobals.save_sequence()\n",
                    "borderRadius": "auto"
                  },
                  {
                    "type": "switch",
                    "top": 0,
                    "left": 0,
                    "lock": false,
                    "id": "seq_steps",
                    "visible": true,
                    "interaction": true,
                    "comments": "",
                    "width": "40%",
                    "height": "30%",
                    "expand": "false",
                    "colorText": "#ffffff",
                    "colorWidget": "#8cedd0",
                    "colorStroke": "#dedfe2",
                    "colorFill": "auto",
                    "alphaStroke": "auto",
                    "alphaFillOff": "auto",
                    "alphaFillOn": "auto",
                    "lineWidth": 0,
                    "padding": "auto",
                    "html": "",
                    "css": "",
                    "layout": "horizontal",
                    "gridTemplate": "",
                    "value": "",
                    "default": 16,
                    "linkId": "",
                    "address": "auto",
                    "preArgs": "",
                    "typeTags": "",
                    "decimals": 2,
                    "target": "",
                    "ignoreDefaults": false,
                    "bypass": true,
                    "onCreate": "",
                    "onValue": "if(globals.seq_connected){\nconsole.log(\"triggering length change\",globals.seq_connected)\n//globals.set_length()\nglobals.save_sequence()\n}\n",
                    "colorTextOn": "auto",
                    "wrap": false,
                    "values": {
                      "4": 4,
                      "6": 6,
                      "8": 8,
                      "12": 12,
                      "16": 16,
                      "32": 32
                    },
                    "mode": "tap",
                    "borderRadius": "auto"
                  },
                  {
                    "type": "matrix",
                    "top": "30%",
                    "left": 0,
                    "lock": false,
                    "id": "seq_leds",
                    "visible": true,
                    "interaction": true,
                    "comments": "",
                    "width": "100%",
                    "height": "10%",
                    "expand": "false",
                    "colorText": "auto",
                    "colorWidget": "#000000",
                    "colorStroke": "auto",
                    "colorFill": "auto",
                    "alphaStroke": 0,
                    "alphaFillOff": "auto",
                    "alphaFillOn": 0,
                    "lineWidth": 0,
                    "padding": 1,
                    "html": "",
                    "css": "",
                    "layout": "horizontal",
                    "gridTemplate": "",
                    "value": "",
                    "default": "",
                    "linkId": "",
                    "address": "auto",
                    "preArgs": "",
                    "typeTags": "",
                    "decimals": 2,
                    "target": "",
                    "ignoreDefaults": false,
                    "bypass": false,
                    "onCreate": "",
                    "onValue": "",
                    "colorBg": "auto",
                    "justify": "start",
                    "contain": true,
                    "scroll": true,
                    "innerPadding": true,
                    "variables": "@{parent.variables}",
                    "traversing": true,
                    "widgetType": "button",
                    "quantity": "@{seq_steps}",
                    "props": "JS{\n  const p = {}\n  var css = new Array(32)\n  var sixteenth = parseInt(@{seq_position})\n  var res = @{seq_resolution} * 4\n  var lastStep = @{seq_steps}\n  var step = parseInt((sixteenth / res) % lastStep)\n  css[step] = \":host{background:rgba(255,0,0,.4);}\"\n  p.mode = \"momentary\"\n  p.label = \"#{$+1}\",\n  p.onValue = \"set('seq_buttons/'+ #{$},0)\"\n  p.lineWidth = 0\n  p.css = css[$]\n  return p\n}",
                    "widgets": [],
                    "tabs": [],
                    "borderRadius": "auto",
                    "tabsPosition": "top"
                  },
                  {
                    "type": "matrix",
                    "top": "40%",
                    "left": 0,
                    "lock": false,
                    "id": "seq_buttons",
                    "visible": "!@{command_velocity}",
                    "interaction": true,
                    "comments": "",
                    "width": "100%",
                    "height": "60%",
                    "expand": "false",
                    "colorText": "auto",
                    "colorWidget": "#b0c9e3",
                    "colorStroke": "auto",
                    "colorFill": "auto",
                    "alphaStroke": "auto",
                    "alphaFillOff": "auto",
                    "alphaFillOn": "auto",
                    "lineWidth": 0,
                    "padding": 1,
                    "html": "",
                    "css": ".fader-container {\n line-width: 0rem;\n}\n",
                    "layout": "horizontal",
                    "gridTemplate": "",
                    "value": "",
                    "default": "",
                    "linkId": "",
                    "address": "auto",
                    "preArgs": "",
                    "typeTags": "",
                    "decimals": 2,
                    "target": "",
                    "ignoreDefaults": false,
                    "bypass": true,
                    "onCreate": "",
                    "onValue": "console.log(\"triggering note value change\")\nconst echo = getVar(\"seq_note_echo\",\"echoVal\"), idx = getIndex(id), val = value[idx], all = get('seq_note_echo_all'), len = value.length\n//console.log(\"echo \" + echo + \" idx \" + idx + \" val \" + val + \" all \"+ all, value)\n\nif(all && echo !== 0){\n  var i = idx\n  while(i < len){\n    if((i-idx) % echo === 0){\n        set('seq_buttons/' + i, Math.round(val),{script: false})\n    }\n    i++\n  }\n \n}else if(echo !== 0){\n      const echoIdx = idx + echo\n      set('seq_buttons/' + echoIdx, Math.round(val),{script: false})\n  }\nfor (var i in value) {\n  set('seq_faders/' + i, Math.round(value[i]),{script: false})\n}\n//globals.send_seq()\nglobals.save_sequence()",
                    "colorBg": "auto",
                    "justify": "start",
                    "contain": true,
                    "scroll": true,
                    "innerPadding": true,
                    "variables": "@{parent.variables}",
                    "traversing": true,
                    "widgetType": "button",
                    "quantity": "@{seq_steps}",
                    "props": "JS{\n  const p = {}\n  \n  p.lineWidth = 0\n  p.alphaFillOff = 0.05\n  p.alphaFillOn = 1\n  p.design = \"compact\"\n  p.knobSize = 0\n  p.variables = @{parent.variables}\n  //p.preArgs = [@{seq_steps},@{seq_resolution}]\n  p.bypass = true\n  p.ignoreDefaults = true\n  p.label = $+1\n  p.onValue = \"console.log('triggering from button')\"\n  return p\n  \n}\n\n",
                    "widgets": [],
                    "tabs": [],
                    "borderRadius": "auto",
                    "tabsPosition": "top"
                  },
                  {
                    "type": "matrix",
                    "top": "40%",
                    "left": 0,
                    "lock": false,
                    "id": "seq_faders",
                    "visible": "@{command_velocity}",
                    "interaction": true,
                    "comments": "",
                    "width": "100%",
                    "height": "60%",
                    "expand": "false",
                    "colorText": "auto",
                    "colorWidget": "#b0c9e3",
                    "colorStroke": "auto",
                    "colorFill": "auto",
                    "alphaStroke": "auto",
                    "alphaFillOff": "auto",
                    "alphaFillOn": "auto",
                    "lineWidth": 0,
                    "padding": 1,
                    "html": "",
                    "css": ".fader-container {\n line-width: 0rem;\n}\n",
                    "layout": "horizontal",
                    "gridTemplate": "",
                    "value": "",
                    "default": "",
                    "linkId": "",
                    "address": "auto",
                    "preArgs": "",
                    "typeTags": "",
                    "decimals": 2,
                    "target": "",
                    "ignoreDefaults": false,
                    "bypass": false,
                    "onCreate": "",
                    "onValue": "// for (var i in value) {\n//   set('seq_buttons/' + i, Math.round(value[i]),{script: false})\n// }\n//globals.send_seq()\n//globals.save_sequence()\n",
                    "colorBg": "auto",
                    "justify": "start",
                    "contain": true,
                    "scroll": true,
                    "innerPadding": true,
                    "variables": "@{parent.variables}",
                    "traversing": true,
                    "widgetType": "fader",
                    "quantity": "@{seq_steps}",
                    "props": "JS{\n  const p = {}\n  p.lineWidth = 0\n  p.alphaFillOff = 0.05\n  p.alphaFillOn = 1\n  p.design = \"compact\"\n  p.knobSize = 0\n  p.variables = @{parent.variables}\n  p.preArgs = [@{seq_steps},@{seq_resolution}]\n  p.bypass = true\n  return p\n  \n}\n\n",
                    "widgets": [],
                    "tabs": [],
                    "borderRadius": "auto",
                    "tabsPosition": "top"
                  }
                ],
                "tabs": [],
                "borderRadius": "auto",
                "tabsPosition": "top"
              }
            ],
            "tabs": [],
            "borderRadius": "auto",
            "tabsPosition": "top"
          },
          {
            "type": "script",
            "lock": false,
            "id": "long_press_button",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "globals.long_press_button = function(pressed, idx, longPress = () => {}, release = () => {}, longRelease = () => {}){\n  console.log(\"hi\")\n  if (pressed == 1) {\n  locals.timerRunning = true\n  locals.pressTimeout = setTimeout(()=>{\n    longPress()\n   console.log(\"held\")\n   locals.timerRunning = false\n  \n    \n  }, 1000) \n} else {\n  if(locals.timerRunning){\n    clearTimeout(locals.pressTimeout)\n    locals.timerRunning = false\n    console.log('release')\n    release()\n}  else\n    console.log('long release')\n    longRelease()\n  \n}\n  \n  \n  \n  \n  \n}",
            "onValue": "",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "script",
            "lock": false,
            "id": "send_mutes",
            "comments": "",
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "globals.send_mutes = function(){\n  if(globals.seq_muted){\n    const instruments = globals.seq_instruments, keys = Object.keys(instruments)\n    var mutes = []\n    for(var idx in globals.seq_muted){\n      mutes.push(instruments[keys[globals.seq_muted[idx]]].trackName)\n    }\n    send('/live/seq/mute', String(mutes))\n\n  }\n}",
            "onValue": "",
            "onKeyboard": "",
            "keyBinding": "",
            "keyRepeat": true,
            "keyType": "keydown"
          },
          {
            "type": "variable",
            "lock": false,
            "id": "vertical_text_css",
            "comments": "",
            "value": "div.html{\n    z-index:-1;\n    font-size:2em;\n    position:absolute;\n    top:50%;\n    left:50%;\n    transform: translateX(-50%) translateY(-50%) rotate(-90deg);\n    opacity:.8;",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": ""
          },
          {
            "type": "panel",
            "top": "51.75%",
            "left": "12.1%",
            "lock": false,
            "id": "seq_echo",
            "visible": true,
            "interaction": true,
            "comments": "",
            "width": "17.2%",
            "height": "14%",
            "expand": "false",
            "colorText": "auto",
            "colorWidget": "auto",
            "colorStroke": "auto",
            "colorFill": "auto",
            "alphaStroke": "auto",
            "alphaFillOff": "auto",
            "alphaFillOn": "auto",
            "lineWidth": 1,
            "borderRadius": "auto",
            "padding": 0,
            "html": "",
            "css": "",
            "colorBg": "auto",
            "layout": "horizontal",
            "justify": "start",
            "gridTemplate": "",
            "contain": true,
            "scroll": true,
            "innerPadding": true,
            "tabsPosition": "top",
            "variables": "@{parent.variables}",
            "traversing": false,
            "value": "",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": "",
            "widgets": [
              {
                "type": "fader",
                "top": "auto",
                "left": "auto",
                "lock": false,
                "id": "seq_note_echo",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "auto",
                "height": "100%",
                "expand": true,
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": 1,
                "borderRadius": "auto",
                "padding": 0,
                "html": "Echo",
                "css": "@{vertical_text_css}",
                "design": "compact",
                "knobSize": "auto",
                "horizontal": false,
                "pips": false,
                "dashed": false,
                "gradient": [],
                "snap": false,
                "spring": false,
                "doubleTap": false,
                "range": {
                  "min": 0,
                  "max": 1
                },
                "logScale": false,
                "sensitivity": 1,
                "steps": "",
                "origin": "auto",
                "value": "",
                "default": "",
                "linkId": "",
                "address": "/live/control",
                "preArgs": [
                  "DrumMachine",
                  1,
                  0
                ],
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "",
                "onTouch": ""
              },
              {
                "type": "fader",
                "top": "auto",
                "left": "auto",
                "lock": false,
                "id": "seq_note_echo_time",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": 60,
                "height": "auto",
                "expand": true,
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": 1,
                "borderRadius": "auto",
                "padding": 0,
                "html": "Time",
                "css": "@{vertical_text_css}",
                "design": "compact",
                "knobSize": "auto",
                "horizontal": false,
                "pips": false,
                "dashed": false,
                "gradient": [],
                "snap": false,
                "spring": false,
                "doubleTap": false,
                "range": {
                  "min": 0,
                  "max": 0.5
                },
                "logScale": false,
                "sensitivity": 1,
                "steps": "",
                "origin": "auto",
                "value": "",
                "default": "",
                "linkId": "",
                "address": "/live/control",
                "preArgs": [
                  "DrumMachine",
                  2,
                  0
                ],
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "",
                "onTouch": ""
              },
              {
                "type": "fader",
                "top": 0,
                "left": 0,
                "lock": false,
                "id": "seq_note_fbk",
                "visible": true,
                "interaction": true,
                "comments": "",
                "width": "auto",
                "height": "100%",
                "expand": true,
                "colorText": "auto",
                "colorWidget": "auto",
                "colorStroke": "auto",
                "colorFill": "auto",
                "alphaStroke": "auto",
                "alphaFillOff": "auto",
                "alphaFillOn": "auto",
                "lineWidth": 1,
                "borderRadius": "auto",
                "padding": 0,
                "html": "Feedback",
                "css": "@{vertical_text_css}",
                "design": "compact",
                "knobSize": "auto",
                "horizontal": false,
                "pips": false,
                "dashed": false,
                "gradient": [],
                "snap": false,
                "spring": false,
                "doubleTap": false,
                "range": {
                  "min": 0,
                  "max": 1
                },
                "logScale": false,
                "sensitivity": 1,
                "steps": "",
                "origin": "auto",
                "value": "",
                "default": "",
                "linkId": "",
                "address": "/live/control",
                "preArgs": [
                  "DrumMachine",
                  3,
                  0
                ],
                "typeTags": "",
                "decimals": 2,
                "target": "",
                "ignoreDefaults": false,
                "bypass": false,
                "onCreate": "",
                "onValue": "",
                "onTouch": ""
              }
            ],
            "tabs": []
          },
          {
            "type": "xy",
            "top": "51.75%",
            "left": "47.5%",
            "lock": false,
            "id": "seq_filter",
            "visible": true,
            "interaction": true,
            "comments": "",
            "width": "28.5%",
            "height": "14%",
            "expand": "false",
            "colorText": "auto",
            "colorWidget": "auto",
            "colorStroke": "auto",
            "colorFill": "auto",
            "alphaStroke": "auto",
            "alphaFillOff": "auto",
            "alphaFillOn": "auto",
            "lineWidth": "auto",
            "borderRadius": "auto",
            "padding": "auto",
            "html": "",
            "css": "",
            "pointSize": 20,
            "ephemeral": false,
            "pips": true,
            "snap": false,
            "spring": false,
            "rangeX": {
              "min": 0,
              "max": 1
            },
            "rangeY": {
              "min": 0,
              "max": 1
            },
            "logScaleX": false,
            "logScaleY": false,
            "doubleTap": false,
            "sensitivity": 1,
            "value": [
              1,
              1
            ],
            "default": [
              1,
              1
            ],
            "linkId": "",
            "address": "/live/xy",
            "preArgs": [
              "Sequencer",
              1,
              2,
              0
            ],
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": "",
            "onTouch": ""
          },
          {
            "type": "matrix",
            "top": "51.75%",
            "left": "82.5%",
            "lock": false,
            "id": "seq_note_echo",
            "visible": true,
            "interaction": true,
            "comments": "",
            "width": "11.25%",
            "height": "14%",
            "expand": "false",
            "colorText": "auto",
            "colorWidget": "auto",
            "colorStroke": "auto",
            "colorFill": "auto",
            "alphaStroke": "auto",
            "alphaFillOff": "auto",
            "alphaFillOn": "auto",
            "lineWidth": "auto",
            "borderRadius": "auto",
            "padding": "auto",
            "html": "",
            "css": "",
            "layout": "grid",
            "gridTemplate": "",
            "value": "VAR{\"echoVal\",0}",
            "default": "",
            "linkId": "",
            "address": "auto",
            "preArgs": "",
            "typeTags": "",
            "decimals": 2,
            "target": "",
            "ignoreDefaults": false,
            "bypass": false,
            "onCreate": "",
            "onValue": "\n\nvar idx = getIndex(id)\n\nsetVar(\"this\",\"echoVal\",value[idx] )\n\nfor(var i = 0; i<value.length; i++){\n  if(i != idx){\n    set('seq_note_echo/' + i, 0, {send:false})\n  }  \n}\n",
            "colorBg": "auto",
            "justify": "start",
            "contain": true,
            "scroll": true,
            "innerPadding": true,
            "tabsPosition": "top",
            "variables": "@{parent.variables}",
            "traversing": false,
            "widgetType": "button",
            "quantity": 6,
            "props": "JS{{\n  var p = {}\n  const obj = {\n  \"1\":1,\n  \"2\":2,\n  \"3\":3,\n  \"4\":4,\n  \"5\":5\n  \n}, labels = Object.keys(obj), values = Object.values(obj), idx = $\n\n// p.preArgs = [\"Key Midi\", 2, 0]\n// p.address = \"/live/control\"\n\np.on = values[$]\np.off = 0\np.label = labels[$]\n\nreturn p\n\n}}",
            "widgets": [],
            "tabs": []
          }
        ],
        "tabs": [],
        "onValue": "",
        "lock": false,
        "onCreate": "",
        "borderRadius": "auto",
        "tabsPosition": "top"
      }
    ],
    "comments": "",
    "onValue": "console.log(\"tab\", value, get('current_song'))\n\n//if(value == 0 && get('current_song') != -1){\n  //send(\"/GigPerformer/SetlistView\")\n//} else{\n//send(\"/GigPerformer/PanelView\")\n//}",
    "lock": false,
    "hideMenu": false,
    "onCreate": "",
    "borderRadius": "auto",
    "tabsPosition": "top"
  }
}